<div style="height: 400px" id="infovis"></div>
<link href="http://sblara.dev/metronic_custom/market_frame/treemap.css" rel="stylesheet" type="text/css" />
<script src="http://sblara.dev/metronic_custom/market_frame/jit-yc.js"></script>

<script>

var labelType, useGradients, nativeTextSupport, animate;

(function() {
    var ua = navigator.userAgent,
        iStuff = ua.match(/iPhone/i) || ua.match(/iPad/i),
        typeOfCanvas = typeof HTMLCanvasElement,
        nativeCanvasSupport = (typeOfCanvas == 'object' || typeOfCanvas == 'function'),
        textSupport = nativeCanvasSupport
            && (typeof document.createElement('canvas').getContext('2d').fillText == 'function');
    //I'm setting this based on the fact that ExCanvas provides text support for IE
    //and that as of today iPhone/iPad current text support is lame
    labelType = (!nativeCanvasSupport || (textSupport && !iStuff))? 'Native' : 'HTML';
    nativeTextSupport = labelType == 'Native';
    useGradients = nativeCanvasSupport;
    animate = !(iStuff || !nativeCanvasSupport);
})();

var Log = {
    elem: false,
    write: function(text){
        if (!this.elem)
            this.elem = document.getElementById('log');
        this.elem.innerHTML = text;
        this.elem.style.left = (500 - this.elem.offsetWidth / 2) + 'px';
    }
};

function sbTip(tip, node, isLeaf, domElement) {
    var data = node.data;
    var arrowClass = 0 < data.$price_change_per ? 'priceUpHeaderSearch' : (0 == data.$price_change_per) ? 'priceStaticHeaderSearch' : 'priceDownHeaderSearch';
    var html = "<div class=\"tip-wrap\"><span style='font-weight:bold'>" + node.name + "</span>";
    if (data.$price_change_per != undefined) {
        html += "&nbsp;<span class='" + arrowClass + "'>&nbsp;</span>&nbsp; &nbsp;&nbsp;<br>";
    }
    if (data.$sector != undefined) {
        html += "<span class='tip-node-attributes-sector'>" + data.$sector + "</span><br>";
    }
    if (data.$volume) {
        html += "<span class='tip-node-attributes-key'>Volume : <span class='tip-node-attributes-value'>" + data.$volume + "</span></span><br>";
    } else if (data.$turn_over) {
        html += "<span class='tip-node-attributes-key'>Turnover : <span class='tip-node-attributes-value'>" + data.$turn_over + "</span></span><br>";
    } else if (data.$no_of_trade) {
        html += "<span class='tip-node-attributes-key'>Trades : <span class='tip-node-attributes-value'>" + data.$no_of_trade + "</span></span><br>";
    }
    if (data.$price != undefined) {
        html += "<span class='tip-node-attributes-key'>Current Price : <span class='tip-node-attributes-value'>" + data.$price + "</span></span><br>";
    }
    if (data.$price_change_per != undefined) {
        html += "<span class='tip-node-attributes-key'>Change Percent : <span class='tip-node-attributes-value'>" + data.$price_change_per + " % </span></span><br>";
    }
    html += "</div>";
    tip.innerHTML = html;
}

function setFontSize(node) {
    var noOfCharacters = node.name.length;
    var labelElementWidth = parseInt(node.endData.$width);
    var proposingFontSize;
    proposingFontSize = parseInt(labelElementWidth / noOfCharacters);
    proposingFontSize = parseInt(proposingFontSize * (1.12));
    return proposingFontSize;
}

function init(){
    //init data
    var LIGHT_RED = "light-red";
    var DARK_RED = "deep-red";
    var DARK = "dark";
    var DARK_GREEN = "deep-green";
    var LIGHT_GREEN = "light-green";
    var EXCHANGE_AREA = 213.708;

    var FONT_THRESHOLD_MIN_SIZE = 7;
    var REDUCE = 3;
    var PUSH_VAL = 4;
    var containerHeight = $jit.id('infovis').offsetHeight;
    var containerWidth = $jit.id('infovis').offsetWidth;
    var containerArea = containerHeight * containerWidth;

    var json = {"data":{"$class":"exchnage"},"id":"root","name":"Dhaka Stock Exchange","children":[{"children":[{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"1JANATAMF","$price":7.3,"$sector":"Mutual Funds","$volume":1570149,"$no_of_trade":280,"$turn_over":11.414,"$price_change":0.1,"$price_change_per":1.39,"$image":"#","$area":11.414},"id":"dse_141JANATAMF","name":"1JANATAMF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"1STPRIMFMF","$price":11.8,"$sector":"Mutual Funds","$volume":188590,"$no_of_trade":85,"$turn_over":2.247,"$price_change":-0.2,"$price_change_per":-1.67,"$image":"#","$area":2.247},"id":"dse_141STPRIMFMF","name":"1STPRIMFMF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"ABB1STMF","$price":7.2,"$sector":"Mutual Funds","$volume":1542711,"$no_of_trade":130,"$turn_over":11.132,"$price_change":0,"$price_change_per":0,"$image":"#","$area":11.132},"id":"dse_14ABB1STMF","name":"ABB1STMF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"AIBL1STIMF","$price":8.3,"$sector":"Mutual Funds","$volume":397524,"$no_of_trade":39,"$turn_over":3.321,"$price_change":0,"$price_change_per":0,"$image":"#","$area":3.321},"id":"dse_14AIBL1STIMF","name":"AIBL1STIMF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"ATCSLGF","$price":10.5,"$sector":"Mutual Funds","$volume":190877,"$no_of_trade":38,"$turn_over":1.99,"$price_change":0.1,"$price_change_per":0.96,"$image":"#","$area":1.99},"id":"dse_14ATCSLGF","name":"ATCSLGF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"CAPMBDBLMF","$price":8.7,"$sector":"Mutual Funds","$volume":24530,"$no_of_trade":19,"$turn_over":0.214,"$price_change":0.1,"$price_change_per":1.16,"$image":"#","$area":0.214},"id":"dse_14CAPMBDBLMF","name":"CAPMBDBLMF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"DBH1STMF","$price":8.5,"$sector":"Mutual Funds","$volume":188918,"$no_of_trade":43,"$turn_over":1.602,"$price_change":0,"$price_change_per":0,"$image":"#","$area":1.602},"id":"dse_14DBH1STMF","name":"DBH1STMF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"EBL1STMF","$price":7.5,"$sector":"Mutual Funds","$volume":964125,"$no_of_trade":98,"$turn_over":7.15,"$price_change":0.2,"$price_change_per":2.74,"$image":"#","$area":7.15},"id":"dse_14EBL1STMF","name":"EBL1STMF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"EBLNRBMF","$price":6.8,"$sector":"Mutual Funds","$volume":558763,"$no_of_trade":108,"$turn_over":3.873,"$price_change":0,"$price_change_per":0,"$image":"#","$area":3.873},"id":"dse_14EBLNRBMF","name":"EBLNRBMF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"EXIM1STMF","$price":7.9,"$sector":"Mutual Funds","$volume":750813,"$no_of_trade":71,"$turn_over":5.936,"$price_change":-0.1,"$price_change_per":-1.25,"$image":"#","$area":5.936},"id":"dse_14EXIM1STMF","name":"EXIM1STMF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"FBFIF","$price":6.8,"$sector":"Mutual Funds","$volume":1104500,"$no_of_trade":189,"$turn_over":7.513,"$price_change":0,"$price_change_per":0,"$image":"#","$area":7.513},"id":"dse_14FBFIF","name":"FBFIF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"GRAMEENS2","$price":14.6,"$sector":"Mutual Funds","$volume":818035,"$no_of_trade":205,"$turn_over":11.933,"$price_change":0.2,"$price_change_per":1.39,"$image":"#","$area":11.933},"id":"dse_14GRAMEENS2","name":"GRAMEENS2"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"GREENDELMF","$price":8.4,"$sector":"Mutual Funds","$volume":388915,"$no_of_trade":52,"$turn_over":3.265,"$price_change":0.1,"$price_change_per":1.2,"$image":"#","$area":3.265},"id":"dse_14GREENDELMF","name":"GREENDELMF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"ICB2NDNRB","$price":10.6,"$sector":"Mutual Funds","$volume":38235,"$no_of_trade":20,"$turn_over":0.404,"$price_change":0.1,"$price_change_per":0.95,"$image":"#","$area":0.404},"id":"dse_14ICB2NDNRB","name":"ICB2NDNRB"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"ICB3RDNRB","$price":7.4,"$sector":"Mutual Funds","$volume":112600,"$no_of_trade":40,"$turn_over":0.835,"$price_change":0,"$price_change_per":0,"$image":"#","$area":0.835},"id":"dse_14ICB3RDNRB","name":"ICB3RDNRB"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"ICBAMCL2ND","$price":10,"$sector":"Mutual Funds","$volume":44915,"$no_of_trade":28,"$turn_over":0.448,"$price_change":0,"$price_change_per":0,"$image":"#","$area":0.448},"id":"dse_14ICBAMCL2ND","name":"ICBAMCL2ND"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"ICBEPMF1S1","$price":7.8,"$sector":"Mutual Funds","$volume":138475,"$no_of_trade":51,"$turn_over":1.079,"$price_change":0,"$price_change_per":0,"$image":"#","$area":1.079},"id":"dse_14ICBEPMF1S1","name":"ICBEPMF1S1"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"ICBSONALI1","$price":8.3,"$sector":"Mutual Funds","$volume":79640,"$no_of_trade":33,"$turn_over":0.661,"$price_change":-0.1,"$price_change_per":-1.19,"$image":"#","$area":0.661},"id":"dse_14ICBSONALI1","name":"ICBSONALI1"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"IFIC1STMF","$price":7.1,"$sector":"Mutual Funds","$volume":443393,"$no_of_trade":72,"$turn_over":3.153,"$price_change":0,"$price_change_per":0,"$image":"#","$area":3.153},"id":"dse_14IFIC1STMF","name":"IFIC1STMF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"IFILISLMF1","$price":8.6,"$sector":"Mutual Funds","$volume":46450,"$no_of_trade":39,"$turn_over":0.399,"$price_change":0,"$price_change_per":0,"$image":"#","$area":0.399},"id":"dse_14IFILISLMF1","name":"IFILISLMF1"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"LRGLOBMF1","$price":7.4,"$sector":"Mutual Funds","$volume":588043,"$no_of_trade":66,"$turn_over":4.392,"$price_change":0.1,"$price_change_per":1.37,"$image":"#","$area":4.392},"id":"dse_14LRGLOBMF1","name":"LRGLOBMF1"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"MBL1STMF","$price":8.4,"$sector":"Mutual Funds","$volume":189830,"$no_of_trade":25,"$turn_over":1.6,"$price_change":0,"$price_change_per":0,"$image":"#","$area":1.6},"id":"dse_14MBL1STMF","name":"MBL1STMF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"NCCBLMF1","$price":8,"$sector":"Mutual Funds","$volume":593204,"$no_of_trade":36,"$turn_over":4.76,"$price_change":0,"$price_change_per":0,"$image":"#","$area":4.76},"id":"dse_14NCCBLMF1","name":"NCCBLMF1"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"NLI1STMF","$price":14.3,"$sector":"Mutual Funds","$volume":227651,"$no_of_trade":53,"$turn_over":3.282,"$price_change":0.2,"$price_change_per":1.42,"$image":"#","$area":3.282},"id":"dse_14NLI1STMF","name":"NLI1STMF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"PF1STMF","$price":8,"$sector":"Mutual Funds","$volume":480305,"$no_of_trade":71,"$turn_over":3.889,"$price_change":0,"$price_change_per":0,"$image":"#","$area":3.889},"id":"dse_14PF1STMF","name":"PF1STMF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"PHPMF1","$price":7.7,"$sector":"Mutual Funds","$volume":9446382,"$no_of_trade":886,"$turn_over":71.956,"$price_change":0.1,"$price_change_per":1.32,"$image":"#","$area":71.956},"id":"dse_14PHPMF1","name":"PHPMF1"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"POPULAR1MF","$price":7.1,"$sector":"Mutual Funds","$volume":3305942,"$no_of_trade":306,"$turn_over":23.707,"$price_change":-0.1,"$price_change_per":-1.39,"$image":"#","$area":23.707},"id":"dse_14POPULAR1MF","name":"POPULAR1MF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"PRIME1ICBA","$price":8.2,"$sector":"Mutual Funds","$volume":123765,"$no_of_trade":44,"$turn_over":1.016,"$price_change":0.2,"$price_change_per":2.5,"$image":"#","$area":1.016},"id":"dse_14PRIME1ICBA","name":"PRIME1ICBA"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"RELIANCE1","$price":10.2,"$sector":"Mutual Funds","$volume":142500,"$no_of_trade":24,"$turn_over":1.461,"$price_change":0,"$price_change_per":0,"$image":"#","$area":1.461},"id":"dse_14RELIANCE1","name":"RELIANCE1"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"SEBL1STMF","$price":13.4,"$sector":"Mutual Funds","$volume":518800,"$no_of_trade":55,"$turn_over":6.939,"$price_change":0.2,"$price_change_per":1.52,"$image":"#","$area":6.939},"id":"dse_14SEBL1STMF","name":"SEBL1STMF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"SEMLIBBLSF","$price":10,"$sector":"Mutual Funds","$volume":300,"$no_of_trade":1,"$turn_over":0.003,"$price_change":0,"$price_change_per":0,"$image":"#","$area":0.003},"id":"dse_14SEMLIBBLSF","name":"SEMLIBBLSF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"SEMLLECMF","$price":9.9,"$sector":"Mutual Funds","$volume":2050,"$no_of_trade":3,"$turn_over":0.02,"$price_change":0,"$price_change_per":0,"$image":"#","$area":0.02},"id":"dse_14SEMLLECMF","name":"SEMLLECMF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"TRUSTB1MF","$price":7.2,"$sector":"Mutual Funds","$volume":1666284,"$no_of_trade":191,"$turn_over":12.022,"$price_change":0,"$price_change_per":0,"$image":"#","$area":12.022},"id":"dse_14TRUSTB1MF","name":"TRUSTB1MF"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"VAMLBDMF1","$price":8.8,"$sector":"Mutual Funds","$volume":1005,"$no_of_trade":2,"$turn_over":0.009,"$price_change":0,"$price_change_per":0,"$image":"#","$area":0.009},"id":"dse_14VAMLBDMF1","name":"VAMLBDMF1"},{"children":[],"data":{"playcount":208,"$color":"#AA5432","$class":"stock","$symbol":"VAMLRBBF","$price":8.7,"$sector":"Mutual Funds","$volume":9500,"$no_of_trade":9,"$turn_over":0.083,"$price_change":0.1,"$price_change_per":1.16,"$image":"#","$area":0.083},"id":"dse_14VAMLRBBF","name":"VAMLRBBF"}],"data":{"playcount":208,"$class":"sector","$area":213.708},"id":"14","name":"Mutual Funds"}]};
    //end
    //init TreeMap
    var tm = new $jit.TM.Squarified({
        //where to inject the visualization
        injectInto: 'infovis',
        //parent box title heights
        titleHeight: 15,
        //enable animations
        animate: animate,
        //box offsets
        offset: 1,
        //Attach left and right click events
        Events: {
            enable: true,
            onClick: function(node) {
                if(node) tm.enter(node);
            },
            onRightClick: function() {
                tm.out();
            }
        },
        duration: 1000,
        //Enable tips
        Tips: {
            enable: true,
            //add positioning offsets
            offsetX: 20,
            offsetY: 20,
            //implement the onShow method to
            //add content to the tooltip when a node
            //is hovered
            onShow:sbTip
        },
        //Add the name of the node in the correponding label
        //This method is called once, on label creation.
        /*
         onCreateLabel: function(domElement, node){
         domElement.innerHTML = node.name;
         var style = domElement.style;
         style.display = '';
         style.border = '1px solid transparent';
         domElement.onmouseover = function() {
         style.border = '1px solid #9FD4FF';
         };
         domElement.onmouseout = function() {
         style.border = '1px solid transparent';
         };
         }
         });*/

        onCreateLabel: function(domElement, node) {
            if (node.data.$class == 'exchange') {
                domElement.innerHTML = node.name;
                domElement.className = "node exchange";
            } else if (node.data.$class == 'sector') {
                domElement.innerHTML = node.name;
                domElement.className = "node sector";
            } else if (node.data.$class == 'stock') {
                var colorClass = LIGHT_GREEN;
                if (node.data.$price_change_per < -2.0) {
                    colorClass = DARK_RED;
                } else if (node.data.$price_change_per < -0) {
                    colorClass = LIGHT_RED;
                } else if (node.data.$price_change_per < 0) {
                    colorClass = LIGHT_GREEN;
                } else if (node.data.$price_change_per < 2.0) {
                    colorClass = DARK_GREEN;
                } else {
                    colorClass = LIGHT_GREEN;
                }
                var fontSizeBySector = parseInt((node.data.$area / node.data.$sectorArea) * 80) + PUSH_VAL;
                var percent = node.data.$price_change_per;
                var fontSize;
                var fontSizeAccordingToSectorArea = parseInt(((node.data.$area / node.data.$sectorArea) * (node.data.$sectorArea / EXCHANGE_AREA)) * 750) + 4;

                var fontSizeAccordingToElementWidth = setFontSize(node);
                fontSize = fontSizeAccordingToElementWidth;

                var Browser = {
                    Version: function() {
                        var version = 999; // we assume a sane browser
                        if (navigator.appVersion.indexOf("MSIE") != -1)
                        // bah, IE again, lets downgrade version number
                            version = parseFloat(navigator.appVersion.split("MSIE")[1]);
                        return version;
                    }
                }

                if (Browser.Version() <= 8) {

                    fontSize =parseInt(fontSizeAccordingToSectorArea * 40 / 100);
                    var dataw = node.data;
                    if (dataw.$noOfTrades) {
                        fontSize =parseInt(fontSizeAccordingToSectorArea * 100 / 100);
                    }
                    else if(dataw.$volume){

                        fontSize =parseInt(fontSizeAccordingToSectorArea * 90 / 100);

                    }
                }
                fontSize = Math.max(fontSize, FONT_THRESHOLD_MIN_SIZE);
                var labelHight = fontSize * 2.2;
                var name = node.name;
                var percentMark = "%";
                if (node.endData.$height < labelHight) {
                    name = "";
                    percent = "";
                    percentMark = "";
                }
                var distance = parseInt((node.endData.$height / 2) - (labelHight / 2));
                var top = (0 < distance) ? distance : 5;
                var fontSizePercentageLabel = ( FONT_THRESHOLD_MIN_SIZE < parseInt(fontSize * 0.75)) ? parseInt(fontSize * 0.75) : FONT_THRESHOLD_MIN_SIZE;
                domElement.innerHTML = "<div style='line-height:" + fontSize + "px;font-size:" + fontSize + "px; position: relative; top:" + top + "px;color: #ffffff'>" + name + " <br><span class='percent-class' style='font-size:" + fontSizePercentageLabel + "px;'>" + percent + percentMark + "</span></div>";
                domElement.className = colorClass + " node stock";
            }
        }
    });
    tm.loadJSON(json);
    tm.refresh();
    //end

}

init();

</script>




